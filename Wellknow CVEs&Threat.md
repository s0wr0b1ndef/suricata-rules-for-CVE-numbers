# suricata-rules-for-CVE-numbers
alert ip $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] RCE attempt via malformed ASPack"; content: "M"; offset: 0; depth: 2; content: "Z"; distance: -2; within: 3; content: "PE"; offset: 64; depth: 2; byte_test: 4, >, 0, 70, little; byte_extract: 4, 144, cve20162208, little; byte_test: 4, >, cve20162208, 328, little; flow: no_stream; reference: cve,2016-2208; classtype: attempted-admin; sid: 10000057; rev: 1;)

alert http any any -> $HOME_NET any (msg: "[PT OPEN] SAP NetWeaver AS Java UDDI 7.11-7.50 SQL Injection (CVE-2016-2386)"; flow: established, to_server; content: "POST"; http_method; content: "/UDDISecurityService/UDDISecurityImplBean"; http_uri; fast_pattern; content: "permissionId"; http_client_body; content: "|27|"; http_client_body; distance: 0; pcre: "/permissionId\s*>[^<]+?\x27/Pi"; reference: cve, 2016-2386; reference: url, github.com/vah13/SAP_exploit; classtype: attempted-recon; sid: 10002408; rev: 1; )

alert http $EXTERNAL_NET any -> $HTTP_SERVERS any (msg: "[PT Open] PHP7 x86 heap overflow attempt via crafted zip archive"; flow: established, to_server; content: "POST"; http_method; content:"PK|01 02|"; fast_pattern; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; reference: cve, 2016-3078; classtype: attempted-admin; sid: 10000037; rev: 1; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] Apache Struts 2.3.20-28 RCE using Dynamic Method Invocation"; content:"#_memberAccess"; http_uri; content: "=";  http_uri; content: "@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS"; http_uri; reference: cve, 2016-3087; reference: url, struts.apache.org/docs/s2-033.html; classtype: attempted-admin; sid: 10000049; rev: 1; )

#Access to internal Magento functions using unserialization of strings
alert http $EXTERNAL_NET any -> $HTTP_SERVERS any (msg: "[PT Open] Magento < 2.0.6 Arbitrary write file"; content: "POST"; http_method; content: "rest/V1/guest-carts/"; http_raw_uri; content: "set-payment-information"; http_raw_uri; fast_pattern; content: "|5C 75 30 30 30 30|"; content: "Magento\\\\Sales\\\\Model\\\\Order\\\\Payment\\\\Transaction"; reference: cve,2016-4010; classtype: web-application-attack; sid: 10000042; rev: 1;)

# GNU Wget < 1.18 Arbitrary File Upload / Potential Remote Code Execution
alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "[PT Open] GNU Wget http request"; content: "wget"; http_user_agent; nocase; depth: 4; flowbits: set, 10000062; flowbits: noalert; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; sid: 10000062; rev: 2; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] GNU Wget < 1.18 Arbitrary File Upload / Potential Remote Code Execution"; flowbits: isset, 10000062; content: "30"; http_stat_code; depth: 2; content: "Location: ftp://"; nocase; http_header; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; sid: 10000063; rev: 2; )

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Likely OpenSSL TLS renegotiations DoS"; flow: to_server, no_stream; content: "|16 03|"; depth: 2; byte_jump: 2,1,relative,big,post_offset -1; isdataat:!2, relative; threshold: type both, track by_src, count 10, seconds 60; reference: url, security.360.cn/cve/CVE-2016-6304; reference: cve, 2016-6304; classtype: attempted-dos; sid: 10000131; rev: 1; )

# GNU Wget < 1.18 Arbitrary File Upload / Potential Remote Code Execution
alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "[PT Open] GNU Wget http request"; content: "wget"; http_user_agent; nocase; depth: 4; flowbits: set, 10000062; flowbits: noalert; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; sid: 10000062; rev: 2; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] GNU Wget < 1.18 Arbitrary File Upload / Potential Remote Code Execution"; flowbits: isset, 10000062; content: "30"; http_stat_code; depth: 2; content: "Location: ftp://"; nocase; http_header; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; sid: 10000063; rev: 2; )

# All versions of Cisco Adaptive Security Appliance are vulnerable to buffer overflow by crafted SNMP packets
alert udp any any -> $HOME_NET 161 (msg: "[PT Open] Cisco Adaptive Security Appliance 8.x SNMP overflow RCE Probe"; byte_jump:1, 6; content: "|A0|"; content: "|2B 06 01 02 01 01 01 00|"; distance: 0; content: "|2B 06 01 02 01 01 03 00|"; distance: 0; content: "|2B 06 01 02 01 01 05 00|"; distance: 0; reference: url, blogs.cisco.com/security/shadow-brokers; reference: cve, 2016-6366; classtype: attempted-recon; sid: 10000098; rev: 1; )

alert udp any any -> $HOME_NET 161 (msg: "[PT Open] Cisco Adaptive Security Appliance 8.x SNMP overflow RCE Attempt"; byte_jump:1, 6; content: "|A5|"; content: "|2B 06 01 02 01 01 01|"; distance: 0; content: "|2B 06 01 04 01 09 09 83 6B 01 03 03 01 01 05 09|"; isdataat:30,relative; reference: url, blogs.cisco.com/security/shadow-brokers; reference: cve, 2016-6366; classtype: attempted-admin; sid: 10000099; rev: 1; )

# Cisco Adaptive Security Appliance CLI Remote Code Execution Vulnerability aka EPICBANANA
alert tcp any any -> $HOME_NET any (msg: "[PT Open] EpicBanana Exploitation"; content: "|50 16 60 16 b8 16 82 16 aa 16 aa 16 aa 16 35 16 aa 16 aa 16 aa 16 aa|"; depth: 24; classtype: attempted-admin; reference: url, tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20160817-asa-cli; reference: cve, 2016-6367; sid:10000100; rev:1;)

# MySQL <= 5.7.15, 5.6.33, 5.5.53 all branches and clones, like: MariaDB, PerconaDB Remote Command Execution via SQL Injection
alert tcp any any -> $HOME_NET any (msg: "[PT Open] MySQL <= 5.7.15, 5.6.33, 5.5.53 root RCE/Privilege Escalation attempt"; content:"|03|"; offset:4; depth:1; content:"736574"; distance:0; content:"6c6f675f66696c65"; distance:0; content:"6d79"; distance:0; content:"2e636e66"; distance:0; within:14; reference: url, legalhackers.com/advisories/MySQL-Exploit-Remote-Root-Code-Execution-Privesc-CVE-2016-6662.html; reference: cve, 2016-6662; classtype: attempted-admin; sid:10000128; rev:1;)

# MySQL <= 5.7.15, 5.6.33, 5.5.53 all branches and clones, like: MariaDB, PerconaDB Remote Command Execution via SQL Injection
alert tcp any any -> $HOME_NET any (msg: "[PT Open] MySQL <= 5.7.15, 5.6.33, 5.5.53 root RCE/Privilege Escalation attempt"; content:"|03|"; offset:4; depth:1; content:"set"; distance:0; content:"log_file"; distance:0; content:"my"; distance:0; content:".cnf"; distance:0; within:7; reference: url, legalhackers.com/advisories/MySQL-Exploit-Remote-Root-Code-Execution-Privesc-CVE-2016-6662.html; reference: cve, 2016-6662; classtype: attempted-admin; sid:10000129; rev:1;)

alert tcp any any -> any 445 (msg: "[PT Open] LSASS Remote Memory Corruption Attempt (MS16-137)"; flow: established, no_stream; content: "|FF|SMB|73 00 00 00 00|"; offset: 4; depth: 9; content: "|FF 00|"; offset: 37; depth: 2; content: "|01 00 00 00 00 00|"; offset: 45; depth: 6; content: "|00 00 00 00 D4 00 00 A0|"; distance: 2; within: 8; content: "|A1 84|"; distance: 2; within: 2; byte_test:1,!=,0xD1,0,relative; flowbits: set, CVE.2016-7237.Attempt; reference: cve, 2016-7237; reference: url, g-laurent.blogspot.ru/2016/11/ms16-137-lsass-remote-memory-corruption.html; classtype: attempted-dos; sid: 10000532; rev: 1; )

alert tcp any 445 -> any any (msg: "[PT Open] LSASS Remote Memory Corruption Successfull LSASS Inf. loop (MS16-137)"; flow: established, no_stream; content: "|FF|SMB|73 05 02 00 C0|"; offset: 4; depth: 9; flowbits: isset, CVE.2016-7237.Attempt; reference: cve, 2016-7237; reference: url, g-laurent.blogspot.ru/2016/11/ms16-137-lsass-remote-memory-corruption.html; classtype: successful-dos; sid: 10000533; rev: 1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Apple macOS 10.12.1/iOS 10 OCSP DDoS Attempt (CVE-2016-7636)"; flow: established, from_server, only_stream; content: "|16 03|"; depth: 2; content: "|16 03|"; content: "|0B|"; distance: 3; within: 1; content: "|30 83|"; content: "|30|"; distance: 3; within: 1; content: "|06 08 2B 06 01 05 05 07 30 02 86|"; distance: 1; within: 11; byte_jump: 1, 0, relative; content: "|30|"; content: "|06 08 2B 06 01 05 05 07 30 02 86|"; distance: 1; within: 11; byte_jump: 1, 0, relative; content: "|30|"; pcre: "/(?:[^\x06]+\x06\x08\x2B\x06\x01\x05\x05\x07\x30\x02\x86){10,}/"; reference: cve, 2016-7636; reference: url, cxsecurity.com/issue/WLB-2016100213; classtype: attempted-dos; sid: 10000495; rev: 1; )

alert dns any any -> $HOME_NET any (msg: "[PT Open] DNS RRSIG without covered RR (CVE-2016-9147)"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 6; content: "|00 00|"; distance: 0; content: "|00 01|"; distance: 1; within: 2; content: "|00 2E 00|"; fast_pattern; distance: 0; pcre: "/.{4,6}\x00\x01\x00\x01.{4}[^\x00]+\x00.{4}[^\x00]+\x00(?:\x2e|\x00\x2e)/"; reference: cve, 2016-9147; reference: url, kb.isc.org/article/AA-01440/74/CVE-2016-9147%3A-An-error-handling-a-query-response-containing-inconsistent-DNSSEC-information-could-cause-an-assertion-failure-.html; classtype: attempted-dos; sid: 10000892; rev: 2; )

# Nagios Core < 4.2.2 Curl Command Injection required a kinda of nagios rss server spoofing
alert http $HOME_NET any -> any any (msg: "[PT Open] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) RSS Request"; flow:established, to_server; content: "/nagios/rss-"; http_uri; content: ".php"; http_uri; distance: 0; content: "User-Agent: magpie"; http_header; nocase; flowbits: set, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; sid: 10000777; rev: 1; ) 

alert http any any -> $HOME_NET any (msg: "[PT Open] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) Attempt"; flow:established, from_server; content: "302"; http_stat_code; content: "nagios"; http_header; flowbits: isset, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; sid: 10000778; rev: 1; ) 

alert http any any -> $HOME_NET any (msg: "[PT Open] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) Remote Script Execution"; flow:established, from_server; content: "302"; http_stat_code; content: "--trace-ascii"; http_header; content: " -F"; http_header; pcre: "/Location\:(?:.*?\s+-F\S+\s+){2}/Hi"; flowbits: isset, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; sid: 10000779; rev: 1; )

alert http any any -> $HOME_NET any (msg: "[PT OPEN] Buffer Overflow via Negative HTTP Chunk size number (FFMPEG CVE-2016-10190, WGET CVE-2017-13089, CVE-2017-13090)"; flow: established, from_server; content: "Transfer-Encoding"; nocase; http_header; content: "chunked"; http_header; nocase; distance: 0; app-layer-event:http.invalid_response_chunk_len; pcre: "/^\s*-[0-9A-Fa-f]+/Qs"; reference: cve, 2016-10190; reference: cve, 2017-13089; reference: cve, 2017-13090; reference: url, trac.ffmpeg.org/ticket/5992; reference: url, bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-13089; classtype: attempted-admin; sid: 10001108; rev: 2; )

alert icmp any any -> any any (msg: "[PT OPEN] Dnsmasq <2.78 Heap Based Buffer Overflow (CVE-2017-14492)"; itype:133; icode: 0; content: "|01|"; offset: 4; depth: 1; byte_test: 1, >, 150, 0, relative; isdataat:1500, relative; reference: cve, 2017-14492; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-admin; sid: 10002469; rev: 2; )

alert udp any any -> any 547 (msg: "[PT OPEN] Possible Dnsmasq <2.78 DHCPv6 Link Layer Address Stack Overflow (CVE-2017-14493)"; flow: no_stream; content: "|0C|"; depth: 1; content: "|00 4F|"; distance: 33; within: 2; byte_test: 2, >, 16, 0, relative, big; isdataat:18,relative; reference: cve, 2017-14493; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-admin; sid: 10002473; rev: 1; )

alert udp any any -> any 547 (msg: "[PT OPEN] Possible Dnsmasq <2.78 DHCPv6 Sensitive info leak (CVE-2017-14494)"; flow: no_stream; content: "|0C|"; depth: 1; content: "|00 09|"; distance: 33; within: 2; content: "|00 01|"; distance: 24; within: 2; byte_test: 2, >, 2, 0, relative, big; isdataat:!3,relative; reference: cve, 2017-14494; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-recon; sid: 10002475; rev: 1; )
alert smtp any any -> $HOME_NET any (msg: "[PT OPEN] Exim 4.88, 4.89 UAF RCE Attempt (CVE-2017-16943)"; flow: established, to_server; content: "BDAT"; content: "BDAT"; within: 10; pcre: "/BDAT\s*\D[^\n\r]*[\n\r][^\n\r]{100}/"; reference: cve, 2017-16943; reference: url, bugs.exim.org/show_bug.cgi?id=2199; classtype: attempted-admin; sid: 10002280; rev: 2; )

alert http any any -> $HOME_NET any (msg: "[PT Open] Safari 10.0.3 UAF RCE (CVE-2017-2491)"; flow: established, from_server; file_data; content: "RegExp"; content: ".repeat"; within: 25; content: ".repeat"; within: 50; content: ".repeat"; within: 50; content: "ArrayBuffer"; within: 100; content: "Uint8Array"; within: 50; content: "Float64Array"; within: 50; content: "jsCellHeader"; distance: 0; content: "butterfly"; distance: 0; reference: cve, 2017-2491; reference: url, github.com/phoenhex/files/blob/master/exploits/cachedcall-uaf.html; classtype: attempted-admin; sid: 10001322; rev: 2; )

alert http any any -> $HOME_NET any (msg: "[PT Open] Safari 10.0.3 UAF RCE (CVE-2017-2491)"; flow: established, from_server; file_data; content: "0x40000"; content: "0x1000"; content: "0x10000000"; content: "0x7ffff000"; content: "0x80"; content: "0x81"; content: "0x50"; reference: cve, 2017-2491; reference: url, github.com/phoenhex/files/blob/master/exploits/cachedcall-uaf.html; classtype: attempted-admin; sid: 10001326; rev: 1; )

alert dns any any -> $HOME_NET any (msg: "[PT Open] ISC BIND DNS TSIG authentication bypass attempt (CVE-2017-3143, HMAC_SHA256)"; flow: to_server; content: "|00 FA|"; content: "|00 00 00 00|"; distance: 2; within: 4; content: "|0B|hmac-sha256|00|"; within: 15; byte_test: 2, >, 32, 8, relative; flowbits: set,CVE.2017-3143.attempt; reference: cve, 2017-3143; reference: url, http://www.synacktiv.ninja/ressources/CVE-2017-3143_BIND9_TSIG_dynamic_updates_vulnerability_Synacktiv.pdf; classtype: attempted-admin; sid: 10001502; rev: 1; )

alert dns any any -> $HOME_NET any (msg: "[PT Open] ISC BIND DNS TSIG authentication bypass successful (CVE-2017-3143)"; flow: from_server; content: "|00 FA|"; content: "|00 00 00 00|"; distance: 2; within: 4; content: "|0B|hmac-sha256|00|"; within: 15; byte_test: 2, >, 0, 8, relative; flowbits: isset,CVE.2017-3143.attempt; flowbits: unset,CVE.2017-3143.attempt; reference: cve, 2017-3143; reference: url, http://www.synacktiv.ninja/ressources/CVE-2017-3143_BIND9_TSIG_dynamic_updates_vulnerability_Synacktiv.pdf; classtype: successful-admin; sid: 10001508; rev: 2; )

alert http $EXTERNAL_NET any -> any any (msg: "[PT Open] Apache Struts < 2.3.32 < 2.5.10.1 RCE through Jakarta Multipart parser Attempt"; flow: established, to_server; content: "%{"; fast_pattern; http_header; content: "multipart/form-data"; http_header; content: "#"; http_header; content: "@"; http_header; pcre: "/Content-Type:(?:[^\r\n]*%{|[^\r\n]*multipart\/form-data|[^\r\n]*#cmd=|[^\r\n]*@java){3}/Gsi"; reference: cve, 2017-5638; reference: url, paper.seebug.org/241/; classtype:attempted-admin; sid: 10001065; rev: 2;)

alert http any any -> $HOME_NET any (msg:"[PT Open] MS IIS 6.0 BO RCE (CVE-2017-7269)"; flow: to_server, established; content: "PROPFIND"; http_method; content: "If: <"; http_header; nocase;  pcre: "/^If: <[^\r\n>]+[\x7F-\xFF]/Hmi"; reference:url, www.helpnetsecurity.com/2017/03/30/cve-2017-7269/; reference: cve, 2017-7269; classtype:attempted-admin; sid: 10001195; rev: 1;)

alert smb any any -> $HOME_NET any (msg:"[PT Open] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|ff 53 4d 42 a2|"; offset: 4; depth: 5; byte_extract: 2, 85, name_length, little; content: "|2f|"; distance: 2; within:name_length; content: !"|04|"; distance: 0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; sid: 10001356; rev: 5;)

alert smb any any -> $HOME_NET any (msg:"[PT Open] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; fast_pattern; byte_extract: 2, 114, name_length, little; byte_jump: 2, 112, little, from_beginning, post_offset 4; content: "|2f|"; distance:0; within:name_length; content: !"|04|"; distance:0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; sid: 10001357; rev: 5;)

alert smb any any -> $HOME_NET any (msg:"[PT Open] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|ff 53 4d 42 2d|"; offset: 4; depth: 5; byte_extract: 2, 67, name_length, little; content: "|2f|"; distance: 2; within:name_length; content: !"|04|"; distance: 0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; sid: 10001438; rev: 1;)

alert tcp $HOME_NET 5672 -> $HOME_NET any (msg: "[PT OPEN] Spring AMQP <1.7.4, 1.6.11, 1.5.7 Java Object Deserialization RCE (CVE--2017-8045)"; flow: established, no_stream; content: "application/x-java-serialized-object"; nocase; content: "|03|"; distance: 1; within: 1; content: "java."; distance: 0; pcre: "/application/x-java-serialized-object.{0,110}(?:org\.(?:apache\.|springframework\.|jboss\.|hibernate\.)|java(?:x\.management\.|\.rmi\.)|com\.sun\.|sun\.reflect\.)/"; reference: cve, 2017-8045; reference: url, pivotal.io/security/cve-2017-8045; classtype: attempted-admin; sid: 10002274; rev: 1; )

alert http $HOME_NET any -> any any (msg: "[PT OPEN] Apache2 <2.2.34 <2.4.27 Optionsbleed (CVE-2017-9798) Leak"; flow: established, from_server; content: "Allow:"; nocase; http_header; pcre: "/Allow:(?: ,|[^\r\n]*(?:[^A-Za-z0-9,\s-_]|,,))/Hi"; threshold: type limit, track by_src, count 1, seconds 10; reference: cve, 2017-9798; reference: url, blog.fuzzing-project.org/60-Optionsbleed-HTTP-OPTIONS-method-can-leak-Apaches-server-memory.html; classtype: attempted-recon; sid: 10001947; rev: 3; )

alert http any any -> $HOME_NET any (msg: "[PT OPEN] Apache2 <2.2.34 <2.4.27 Optionsbleed (CVE-2017-9798) Attempt"; flow: established, to_server; content: "OPTIONS"; http_method; threshold: type both, track by_src, count 20, seconds 30; reference: cve, 2017-9798; reference: url, blog.fuzzing-project.org/60-Optionsbleed-HTTP-OPTIONS-method-can-leak-Apaches-server-memory.html; classtype: attempted-recon; sid: 10001948; rev: 1; )

alert http any any -> $HOME_NET any (msg: "[PT ATTACK] GitHub Electron <1.8.2-beta.4, <1.7.11, <1.6.16 protocol handler RCE (CVE-2018-1000006)"; flow: established, from_server; content: "://"; content: "--gpu-launcher="; nocase; pcre: "/(powershell|cmd|python|bash|\.exe)/i"; reference: cve, 2018-1000006; reference: url, electronjs.org/blog/protocol-handler-fix; classtype: attempted-admin; sid: 10002500; rev: 2; )

alert http any any -> $HOME_NET any (msg: "[PT ATTACK] GitHub Electron <1.8.2-beta.4, <1.7.11, <1.6.16 protocol handler RCE (CVE-2018-1000006)"; flow: established, from_server; content: "://"; content: "-cmd-prefix="; nocase; pcre: "/(powershell|cmd|python|bash|\.exe)/i"; reference: cve, 2018-1000006; reference: url, electronjs.org/blog/protocol-handler-fix; classtype: attempted-admin; sid: 10002501; rev: 3; )

alert tcp any any -> $HOME_NET 25 (msg: "[PT OPEN] Exim <4.90.1 Base64 Overflow RCE (CVE-2018-6789)"; flow: established, to_server, only_stream; content: "|0A|AUTH"; nocase; pcre: "/AUTH\s+(PLAIN|LOGIN|CRAM-MD5)\s+(?:[a-zA-Z0-9\+\/]{4})*+[a-zA-Z0-9\+\/]{3}/i"; reference: cve, 2018-6789; reference: url, https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/; classtype: attempted-admin; sid: 10002643; rev: 4; )

alert tcp any any -> $HOME_NET 139 (msg: "[PT OPEN] Mikrotik <6.41.3 <6.42rc27 RCE Attempt (CVE-2018-7445)"; flow: established, to_server, no_stream; content: "|81 00|"; depth: 2; byte_test: 1, >, 0x20, 2, relative; content: "|00 00 00|"; distance: 0; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: attempted-admin; sid: 10002680; rev: 1; )

alert tcp any any -> $HOME_NET 139 (msg: "[PT OPEN] ShellCode Upload Mikrotik <6.41.3 <6.42rc27 RCE (CVE-2018-7445)"; flow: established, to_server, only_stream; content: "|00 00 eb 02 00 00 eb 02|"; depth: 8; pcre: "/(?:\x00\x00\xeb\x02){10}/R"; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: attempted-admin; sid: 10002681; rev: 1; )

alert tcp $HOME_NET 139 -> any any (msg: "[PT OPEN] Successful Mikrotik <6.41.3 <6.42rc27 RCE (CVE-2018-7445)"; flow: established, from_server, no_stream; content: "sh: "; depth: 4; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: successful-admin; sid: 10002682; rev: 1; )

alert udp any 53 -> $HOME_NET any (msg: "[PT OPEN] DNS Rebinding attack in progress"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04|"; distance: 0; content: !"|7F|"; within: 1; xbits: set, DNSREBINDING.NON_LOCALHOST, track ip_pair, expire 10; flowbits: noalert; classtype: attempted-admin; sid: 10002488; rev: 2; )

alert udp any 53 -> $HOME_NET any (msg: "[PT OPEN] DNS Rebinding attack in progress"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04 7F 00 00 01|"; distance: 0; xbits: isset, DNSREBINDING.NON_LOCALHOST, track ip_pair; threshold: type both, track by_src, count 1, seconds 30; classtype: attempted-admin; sid: 10002489; rev: 1; )

alert udp any 53 -> $HOME_NET any (msg: "[PT OPEN] Possible DNS Rebinding attack"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04 7F 00 00 01|"; distance: 0; threshold: type both, track by_src, count 1, seconds 30; classtype: attempted-admin; sid: 10002490; rev: 1; )
# FreePBX 13/14 Remote Code Execution

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] FreePBX 13/14 Malicious Filename Upload attempt"; content: "POST"; http_method; nocase; content:"/admin/ajax.php?"; http_uri; content:"module=recordings"; http_uri; content:"command=savebrowserrecording"; http_uri; content: "Content-Type: multipart/form-data"; nocase; http_header; pcre:"/Content-Disposition: form-data\; name=\"filename\"\r\n\r\n[^\r\n]*\x60[^\r\n]*\x60.*\r\n/P"; xbits: set, FreePBXMaliciousFilenameUpload, track ip_dst, expire 180; classtype: attempted-user; reference: exploitdb, 40232; sid:10000082; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] FreePBX 13/14 Remote Command Execution"; content: "POST"; http_method; nocase; content:"/admin/ajax.php"; http_uri; content: "Content-Type: application/x-www-form-urlencoded"; nocase; http_header; pcre:"/file=[^&]*\x60[^&]*\x60/P"; pcre:"/module=recordings/P"; xbits: isset, FreePBXMaliciousFilenameUpload, track ip_dst; classtype: successful-user; reference: exploitdb, 40232; sid:10000083; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] FreePBX 13/14 Remote Command Execution attempt"; content:"POST"; http_method; content:"/admin/ajax.php"; http_uri; content:"Content-Type: application/x-www-form-urlencoded"; nocase; http_header; pcre:"/file=[^&]*\x60[^&]*\x60/P"; pcre:"/module=recordings/P"; xbits: isnotset, FreePBXMaliciousFilenameUpload, track ip_dst; classtype: attempted-user; reference: exploitdb, 40232; sid:10000084; rev:1;)

#Rule for SVG popen shell
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] GraphicsMagick and ImageMagick popen shell vulnerability (SVG)"; flow: established, to_server; content:"<?xml"; http_client_body; content:"<svg"; http_client_body; fast_pattern; pcre:"/xlink:href\s*=\s*[\'\"]\|/RPi"; classtype:web-application-attack; sid: 10000044; rev:1;)

#Rule for MVG popen shell
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[PT Open] GraphicsMagick and ImageMagick popen shell vulnerability (MVG)"; flow: established, to_server; content:"viewbox "; nocase; http_client_body; fast_pattern; pcre:"/image\s+copy[\s\d,]+[\"\']\|/RPi"; classtype:web-application-attack; sid: 10000045; rev:1;)

alert smb any any -> $HOME_NET any (msg: "[PT OPEN] Metasploit MS17-010 ETERNALCHAMPION. Non-Fragmented NT Trans Request with command NT Rename (CVE-2017-0146)"; flow: established, to_server; content: "|FF|SMB|A0|"; offset: 4; depth: 5; byte_extract: 4, 35, NTTrans.TotalDataCount, relative, little; byte_test: 4, =, NTTrans.TotalDataCount, 16, relative, little; content: "|05 00|"; distance: 25; within: 2; isdataat:300, relative; flowbits: set, EternalRomance.RaceCondition.Possible; flowbits: noalert; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; sid: 10001717; rev: 2;)

alert smb $HOME_NET any -> any any (msg: "[PT OPEN] NT Trans Response"; flow: established, from_server; content: "|FF|SMB|A0|"; offset: 4; depth: 5; flowbits: isset, EternalRomance.RaceCondition.Possible; flowbits: unset, EternalRomance.RaceCondition.Possible; flowbits: noalert; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; sid: 10001718; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "[PT OPEN] Metasploit MS17-010 ETERNALCHAMPION Race Condition Exploit. NT Trans Secondary packet follows NT Trans Req (CVE-2017-0146)"; flow: established, no_stream, to_server; content: "|FF|SMB|A1|"; flowbits: isset, EternalRomance.RaceCondition.Possible; flowbits: set, EternalRomance.RaceCondition.Attempt; threshold: type both, track by_src, count 1, seconds 60; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; sid: 10001719; rev: 1;)

alert smb $HOME_NET any -> any any (msg: "[PT OPEN] Metasploit MS17-010 ETERNALCHAMPION Successful kernel data leak (CVE-2017-0146)"; flow: established, from_server; content: "|FF|SMB|A0|"; content: "Frag"; within: 115; flowbits: isset, EternalRomance.RaceCondition.Attempt; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; sid: 10001720; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "[PT OPEN] Metasploit MS17-010 ETERNALROMANCE exploitation (CVE-2017-0143)"; flow: established, to_server; content: "|FF|SMB|A1|"; content: "|FF|SMB|A0|"; distance: 0; content: "|05 00|"; distance: 64; within: 2; content: "|FF|SMB|25|"; distance: 13; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; threshold: type both, track by_src, count 1, seconds 60; reference: cve, 2017-0143; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, www.crowdstrike.com/blog/badrabbit-ms17-010-exploitation-part-one-leak-and-control; classtype: attempted-admin; sid: 10001723; rev: 1; )

alert http $HOME_NET any -> $EXTERNAL_NET any  (msg: "[PTsecurity] PowerShell Empire Request HTTP Pattern"; flow: established, to_server; content: "POST"; http_method; content: "HTTP/1.1|0d0a|Cookie: session="; depth:1000; fast_pattern; content: "=|0d0a|User-Agent: Mozilla"; distance:27; within:400; content: "Host: "; within:400; content: "Content-Length: 462|0d0a|"; within: 400; content:!"Referer|3a|"; http_header; content: !"Content-Type: "; http_header; classtype: trojan-activity; metadata: id_399044,created_at 2017_11_21; sid: 10002268; rev: 2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PTsecurity] PowerShell Empire stager receive over HTTP";flow: established, to_client; content:"200"; http_stat_code; content: "If($PSVersionTable.PSVersion.Major -ge 3){"; http_server_body; nocase; depth: 1000; content: "$GPS=[ref].Assembly.GetType("; http_server_body; nocase; within: 100; content: "System.Management.Automation.Utils"; http_server_body; within: 100; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: id_377596,created_at 2017_11_22; sid: 10002269; rev: 1;)

alert http $HOME_NET any -> $HOME_NET $HTTP_PORTS (msg: "[PT Open] Possible Squid cache poisoning"; content: "GET"; http_method; content: "http://"; http_raw_uri; pcre: "/GET\s+\w+:\/\/\S+\s+.*?[\r\n].*?Host: +[\w\.:]+\b/is"; pcre:! "/GET\s+\w+:\/\/([^\/\s]+)[\/\s]\S*.+?Host:\s*\1\S*\b/is"; reference: cve, 2016-4553; classtype: attempted-recon; sid: 10000035; rev: 2; )

alert http any any -> $HOME_NET any (msg: "[PT Open] Apache Continuum <= v1.4.2 CMD Injection"; content: "POST"; http_method; content: "/continuum/saveInstallation.action"; offset: 0; depth: 34; http_uri; content: "installation.varValue="; nocase; http_client_body; pcre: !"/^\$?[\sa-z\\_0-9.-]*(\&|$)/iRP"; flow: to_server, established; classtype: web-application-attack; sid: 10000048; rev: 1;)

# NBNS packets from external net to home net
alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "[PT Open] BadTunnel NBNS Flood"; flow: no_stream; threshold: type both, track by_src, count 5, seconds 1; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3213; classtype: attempted-recon; sid: 10000051; rev:1;)

# BadTunnel WPAD spoofing attempt via NBNS
alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "[PT Open] BadTunnel WPAD spoofing attempt via NBNS"; flow: no_stream; content: "|46 48 46 41 45 42 45 45|"; offset: 13; depth: 8; threshold: type limit, track by_dst, count 1, seconds 30; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3236; classtype: attempted-recon; sid: 10000052; rev:1;)

# BadTunnel ISATAP spoofing attempt via NBNS
alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "[PT Open] BadTunnel ISATAP spoofing attempt via NBNS"; flow: no_stream; content: "|45 4A 46 44 45 42 46 45 45 42 46 41|"; offset: 13; depth: 12; threshold: type limit, track by_dst, count 1, seconds 30; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3236; classtype: attempted-recon; sid: 10000053; rev:1;)

alert tcp any any -> $HOME_NET 445 (msg: "[PT Open] Unimplemented Trans2 Sub-Command code. Possible ETERNALBLUE (WannaCry, Petya) tool"; flow: to_server, established; content: "|FF|SMB2|00 00 00 00|"; depth: 9; offset: 4; byte_test: 2, >, 0x0008, 52, relative, little; pcre: "/\xFFSMB2\x00\x00\x00\x00.{52}(?:\x04|\x09|\x0A|\x0B|\x0C|\x0E|\x11)\x00/"; flowbits: set, SMB.Trans2.SubCommand.Unimplemented; reference: url, msdn.microsoft.com/en-us/library/ee441654.aspx; classtype: attempted-admin; sid: 10001254; rev: 2;)

alert tcp any any -> $HOME_NET 445 (msg: "[PT Open] ETERNALBLUE (WannaCry, Petya) SMB MS Windows RCE"; flow: to_server, established; content: "|FF|SMB3|00 00 00 00|"; depth: 9; offset: 4; flowbits: isset, SMB.Trans2.SubCommand.Unimplemented.Code0E; threshold: type limit, track by_src, seconds 60, count 1; reference: cve, 2017-0144; classtype: attempted-admin; sid: 10001255; rev: 3;)

alert tcp any any -> $HOME_NET 445 (msg: "[PT Open] Trans2 Sub-Command 0x0E. Likely ETERNALBLUE (WannaCry, Petya) tool"; flow: to_server, established; content: "|FF|SMB2|00 00 00 00|"; depth: 9; offset: 4; content: "|0E 00|"; distance: 52; within: 2; flowbits: set, SMB.Trans2.SubCommand.Unimplemented.Code0E; reference: url, msdn.microsoft.com/en-us/library/ee441654.aspx; classtype: attempted-admin; sid: 10001256; rev: 2;)

alert tcp any any -> $HOME_NET 445 (msg: "[PT Open] Petya ransomware perfc.dat component"; flow: to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; byte_jump: 2, 112, little, from_beginning, post_offset 4; content: "|70 00 65 00 72 00 66 00 63 00 2e 00 64 00 61 00 74 00|"; distance:0; classtype:suspicious-filename-detect; sid: 10001443; rev: 1;)

alert tcp any any -> $HOME_NET 445 (msg:"[PT Open] SMB2 Create PSEXESVC.EXE"; flow:to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; byte_jump: 2, 112, little, from_beginning, post_offset 4; content:"|50 00 53 00 45 00 58 00 45 00 53 00 56 00 43 00 2e 00 45 00 58 00 45|"; distance:0; classtype:suspicious-filename-detect; sid: 10001444; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Possible HTTPoxy HTTP_PROXY value spoofing"; flow: established, to_server; content: "|0A|Proxy:"; nocase; http_header; reference: url, httpoxy.org; reference: cve, 2016-5385; reference: cve, 2016-5386; reference: cve, 2016-5387; reference: cve, 2016-5388; reference: cve, 2016-1000109; reference: cve, 2016-1000110; classtype: attempted-recon; sid: 10000065; rev: 3;)

# Alert on really huge (>64k) XCN_OID_PKIX_CA_ISSUERS value in CRT file
# Detects 06 08 2B 06 01 05 05 07 30 02 86 83 with no preceeding bytes
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "BggrBgEFBQcwAoaD"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; sid: 10000757; rev: 1; )

# Detects XX 06 08 2B 06 01 05 05 07 30 02 86 83
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "YIKwYBBQUHMAKGgw"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; sid: 10000758; rev: 1; )

# Detects XX XX 06 08 2B 06 01 05 05 07 30 02 86 83
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "GCCsGAQUFBzAChoM"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; sid: 10000759; rev: 1; )

#Attempt to overflow buffer with malicious flowset_length field
alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Nfcapd buffer overflow via incorrect flowset_length field attempt"; content:"|00 0a|"; depth: 2; content: "|00 02 00|"; distance: 14; within: 3; byte_test: 1, <=, 0x07, 0, relative; byte_test: 1, >=, 0x05, 0, relative; reference: url, https://www.exploit-db.com/exploits/39800/; classtype: attempted-dos; sid: 10000038; rev: 1; )

#Attempt to overflow buffer with malicious scope_field_cound field
alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Nfcapd buffer overflow with large scope_field_count field attempt"; content:"|00 0a|"; depth: 2; content: "|00 03 00|"; distance: 14; within: 3; content: "|00 00|"; distance: 3; within: 2; byte_test: 2, >=, 30000, 0, relative; reference: url, https://www.exploit-db.com/exploits/39800/; classtype: attempted-dos; sid: 10000039; rev: 1; )

#Attempt to send nfcapd into infinite loop
alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "[PT Open] Nfcapd DoS attempt caused inifinite loop"; content:"|00 09|"; depth: 2; content: "|00 00 00 14 04 00 00|"; distance: 18; within: 7; reference: url, https://www.exploit-db.com/exploits/39800/; classtype: attempted-dos; sid: 10000040; rev: 1; )

alert tcp any any -> $HOME_NET any (msg: "[PT OPEN] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established; content: "ssh://-"; nocase; pcre: "/\S{3}/Rsi"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; sid: 10001756; rev: 3; )

alert tcp any [3690, 9418] <> any any (msg: "[PT OPEN] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established; content: "ssh://"; nocase; pcre: "/ssh:\/\/(?:[^@\s]+@)?(?:[\w\:\.\-\[\]\@]+[^\w\:\.\-\[\]\@\/\ ]|[^\w\:\.\-\[\]\@\/\ ][\w\:\.\-\[\]\@])/i"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; sid: 10001757; rev: 3; )

alert http any any -> $HOME_NET any (msg: "[PT OPEN] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established, from_server; content: "30"; http_stat_code; depth: 2; content: "Location:"; http_header; nocase; content: "ssh://"; nocase; http_header; distance: 0; pcre: "/ssh:\/\/(?:[^@\s]+@)?(?:[\w\:\.\-\[\]\@]+[^\w\:\.\-\[\]\@\/\ ]|[^\w\:\.\-\[\]\@\/\ ][\w\:\.\-\[\]\@])/Hi"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; sid: 10001763; rev: 2; )

alert tcp $HOME_NET any -> $DC_SERVERS 88 (msg: "[PT OPEN] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMAC-MD5"; flow: no_stream, established, to_server; content: "|A1 03 02 01 05 A2 03 02 01 0A|"; offset: 12; depth: 10; content: "|A1 03 02 01 02|"; distance: 5; within: 6; content: "|A0 03 02 01 17|"; distance: 6; within: 6; content: "krbtgt"; distance: 0;  xbits: set, Krb5.AsReq, track ip_src, expire: 10; classtype: attempted-user; sid: 10002228; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "[PT OPEN] Flowbits for SMB NTTrans Request"; flow: established, to_server, no_stream; content: "|FF|SMB|A0|"; flowbits: set, SMB.NTTrans.Req; flowbits: unset, SMB.NTTrans2.Req; flowbits: noalert; classtype: attempted-admin; sid: 10001724; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "[PT OPEN] Metasploit MS17-010 ETERNALBLUE Exploitation (CVE-2017-0144)"; flow: established, to_server, no_stream; content: "|FF|SMB|33|"; byte_test: 2, >, 61000, 42, relative, little; flowbits: isset, SMB.NTTrans.Req; flowbits: isnotset, SMB.NTTrans2.Req; reference: cve, 2017-0144; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; classtype: attempted-admin; sid: 10001726; rev: 1; )

alert tcp any any -> $HOME_NET any (msg: "[PT OPEN] Remote WMI Win32_Process create"; flow: established, to_server; content: "|05 00 00|"; depth: 3; content: "W|00|i|00|n|00|3|00|2|00|_|00|P|00|r|00|o|00|c|00|e|00|s|00|s|00 00 00|"; fast_pattern; content: "c|00|r|00|e|00|a|00|t|00|e|00|"; distance: 16; within: 12; nocase; content: "MEOW"; distance: 20; within: 4; content: "object:Win32_ProcessStartup"; distance: 0; flowbits: set, WMI.Win32_Process.Create; threshold: type limit, track by_src, count 1, seconds 10; classtype: attempted-admin; sid: 10001999; rev: 2; )

alert tcp any any -> $HOME_NET any (msg: "[PT OPEN] Suspicious Remote WMI Win32_Process create"; flow: established, to_server; content: "__PARAMETERS|00 00|"; content: "http://"; distance: 0; pcre: "/__PARAMETERS\x00\x00[^\x00]+?(?:cmd|powershell)[^\x00]+?http:\/\//"; flowbits: isset, WMI.Win32_Process.Create; classtype: attempted-admin; sid: 10002000; rev: 2; )
alert http any any -> $HOME_NET any (msg: "[PT OPEN] WordPress Plugin LearnDash LMS <2.5.4 Arbitrary file upload"; flow: established, to_server; content: "POST"; http_method; content: "multipart/form-data"; http_header; content: "course_id"; http_client_body; content: "uploadfile"; http_client_body; content: "uploadfiles[]"; http_client_body; content: "filename"; http_client_body; distance: 0; content: ".php.php"; http_client_body; distance: 0; pcre: "/\.php\.php\s*[\"\']/P"; reference: url, seclists.org/fulldisclosure/2018/Jan/37; classtype: attempted-admin; sid: 10002405; rev: 2; )


# Thank to AttackDetection Team (https://twitter.com/AttackDetection)


